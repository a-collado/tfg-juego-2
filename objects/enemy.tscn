[gd_scene load_steps=33 format=3 uid="uid://dx3yfr7vp3gbn"]

[ext_resource type="PackedScene" uid="uid://nklwmh4e4jwg" path="res://objects/player.tscn" id="1_djgfh"]
[ext_resource type="Script" path="res://scripts/enemy/enemy.gd" id="2_mtiaa"]
[ext_resource type="Script" path="res://addons/StateMachine/state_machine.gd" id="3_03ql3"]
[ext_resource type="Texture2D" uid="uid://bei3ssi477w76" path="res://assets/Modelos 3D/jammo/textures/jammo_albedo_alpha.png" id="3_la5ht"]
[ext_resource type="Shader" uid="uid://rmua1fkabo1e" path="res://assets/Shaders/3D/bat_trail.tres" id="3_yyxms"]
[ext_resource type="Script" path="res://scripts/enemy/states/defend.gd" id="4_4o8ek"]
[ext_resource type="Texture2D" uid="uid://bjji2tdq3g46n" path="res://assets/Modelos 3D/jammo/textures/jammo_ambientocclusion.png" id="4_ofqhh"]
[ext_resource type="Texture2D" uid="uid://027637t71n23" path="res://assets/Modelos 3D/trail/trail_textura_text.png" id="4_ynvwr"]
[ext_resource type="Texture2D" uid="uid://koq1m0etqnc2" path="res://assets/Modelos 3D/jammo/textures/jammo_metal_smoothness.png" id="5_3e77d"]
[ext_resource type="Script" path="res://scripts/enemy/states/idle.gd" id="6_i74hs"]
[ext_resource type="Texture2D" uid="uid://b3fydf6yxrwcc" path="res://assets/Modelos 3D/jammo/textures/jammo_normal.png" id="6_ygmjx"]
[ext_resource type="Script" path="res://scripts/enemy/states/charge.gd" id="9_jc1lt"]
[ext_resource type="Script" path="res://scripts/enemy/states/attack.gd" id="9_rudlm"]

[sub_resource type="Shader" id="Shader_41ici"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.3.stable's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix, depth_draw_opaque, cull_back, diffuse_burley, specular_schlick_ggx;

uniform bool enemy;

uniform vec4 albedo : source_color;
uniform sampler2D texture_albedo : source_color, filter_linear_mipmap, repeat_enable;
uniform float point_size : hint_range(0.1, 128.0, 0.1);

uniform float roughness : hint_range(0.0, 1.0);
uniform sampler2D texture_metallic : hint_default_white, filter_linear_mipmap, repeat_enable;
uniform vec4 metallic_texture_channel;
uniform sampler2D texture_roughness : hint_roughness_r, filter_linear_mipmap, repeat_enable;

uniform float specular : hint_range(0.0, 1.0, 0.01);
uniform float metallic : hint_range(0.0, 1.0, 0.01);

uniform sampler2D texture_normal : hint_roughness_normal, filter_linear_mipmap, repeat_enable;
uniform float normal_scale : hint_range(-16.0, 16.0);

uniform sampler2D texture_ambient_occlusion : hint_default_white, filter_linear_mipmap, repeat_enable;
uniform vec4 ao_texture_channel;
uniform float ao_light_affect : hint_range(0.0, 1.0, 0.01);

uniform vec3 uv1_scale;
uniform vec3 uv1_offset;
uniform vec3 uv2_scale;
uniform vec3 uv2_offset;

void vertex() {
	UV = UV * uv1_scale.xy + uv1_offset.xy;
}

void fragment() {
	vec2 base_uv = UV;

	vec4 albedo_tex = texture(texture_albedo, base_uv);
	ALBEDO = albedo.rgb * albedo_tex.rgb;
	// Intercambiamos el canal x y el z para invertir los colores
	if (enemy){
		ALBEDO = vec3(ALBEDO.z, ALBEDO.y, ALBEDO.x);
	}

	float metallic_tex = dot(texture(texture_metallic, base_uv), metallic_texture_channel);
	METALLIC = metallic_tex * metallic;
	SPECULAR = specular;

	vec4 roughness_texture_channel = vec4(1.0, 0.0, 0.0, 0.0);
	float roughness_tex = dot(texture(texture_roughness, base_uv), roughness_texture_channel);
	ROUGHNESS = roughness_tex * roughness;

	// Normal Map: Enabled
	NORMAL_MAP = texture(texture_normal, base_uv).rgb;
	NORMAL_MAP_DEPTH = normal_scale;

	// Ambient Occlusion: Enabled
	AO = dot(texture(texture_ambient_occlusion, base_uv), ao_texture_channel);
	AO_LIGHT_AFFECT = ao_light_affect;
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ouy15"]
render_priority = 0
shader = SubResource("Shader_41ici")
shader_parameter/enemy = true
shader_parameter/albedo = Color(1, 1, 1, 1)
shader_parameter/point_size = 1.0
shader_parameter/roughness = 1.0
shader_parameter/metallic_texture_channel = null
shader_parameter/specular = 0.5
shader_parameter/metallic = 1.0
shader_parameter/normal_scale = 2.0
shader_parameter/ao_texture_channel = null
shader_parameter/ao_light_affect = 0.0
shader_parameter/uv1_scale = Vector3(1, 1, 1)
shader_parameter/uv1_offset = Vector3(0, 0, 0)
shader_parameter/uv2_scale = Vector3(1, 1, 1)
shader_parameter/uv2_offset = Vector3(0, 0, 0)
shader_parameter/texture_albedo = ExtResource("3_la5ht")
shader_parameter/texture_metallic = ExtResource("5_3e77d")
shader_parameter/texture_normal = ExtResource("6_ygmjx")
shader_parameter/texture_ambient_occlusion = ExtResource("4_ofqhh")

[sub_resource type="BoxShape3D" id="BoxShape3D_p8lqk"]
size = Vector3(2.52759, 1.60049, 0.399414)

[sub_resource type="BoxShape3D" id="BoxShape3D_fsbx3"]
size = Vector3(2.18945, 1.60049, 2.20215)

[sub_resource type="BoxShape3D" id="BoxShape3D_tl0he"]
size = Vector3(1.75195, 1.60049, 0.96582)

[sub_resource type="BoxShape3D" id="BoxShape3D_oht2c"]
size = Vector3(1.21863, 2.35437, 1)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_o7eui"]
resource_local_to_scene = true
render_priority = 0
shader = ExtResource("3_yyxms")
shader_parameter/progress = 0.0
shader_parameter/Texture = ExtResource("4_ynvwr")

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_3khlo"]
animation = &"jammo_library/bat"

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_dbtag"]

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_muwrp"]
resource_local_to_scene = true
graph_offset = Vector2(-396.016, -20.3494)
nodes/Bateo/node = SubResource("AnimationNodeAnimation_3khlo")
nodes/Bateo/position = Vector2(-80, 100)
nodes/TimeScale/node = SubResource("AnimationNodeTimeScale_dbtag")
nodes/TimeScale/position = Vector2(140, 120)
node_connections = [&"TimeScale", 0, &"Bateo", &"output", 0, &"TimeScale"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0smal"]
animation = &"jammo_library/idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_oy3br"]
animation = &"jammo_library/run"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_6xssx"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_nevp0"]
advance_mode = 2
advance_condition = &"is_moving"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_tlhke"]
advance_mode = 2
advance_condition = &"is_idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_xddde"]
advance_mode = 2
advance_condition = &"hit_ball"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_mlc06"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_nljpi"]
resource_local_to_scene = true
states/End/position = Vector2(659, 72.5898)
states/Start/position = Vector2(188, 72.5898)
states/bat/node = SubResource("AnimationNodeBlendTree_muwrp")
states/bat/position = Vector2(562.562, 171.59)
states/idle/node = SubResource("AnimationNodeAnimation_0smal")
states/idle/position = Vector2(391.562, 72.5898)
states/run/node = SubResource("AnimationNodeAnimation_oy3br")
states/run/position = Vector2(562.562, 72.5898)
transitions = ["Start", "idle", SubResource("AnimationNodeStateMachineTransition_6xssx"), "idle", "run", SubResource("AnimationNodeStateMachineTransition_nevp0"), "run", "idle", SubResource("AnimationNodeStateMachineTransition_tlhke"), "run", "bat", SubResource("AnimationNodeStateMachineTransition_xddde"), "bat", "run", SubResource("AnimationNodeStateMachineTransition_mlc06")]
graph_offset = Vector2(-198, 21.4609)

[sub_resource type="ViewportTexture" id="ViewportTexture_brdgy"]
viewport_path = NodePath("hitManager/SubViewport")

[node name="Enemy" instance=ExtResource("1_djgfh")]
transform = Transform3D(6.98928, 0, 0, 0, 6.98928, 0, 0, 0, 6.98928, 0, 0, 0)
script = ExtResource("2_mtiaa")

[node name="Skeleton3D" parent="root" index="0"]
bones/2/position = Vector3(0.000191063, 0.0162169, -0.000324203)
bones/2/rotation = Quaternion(-0.039743, -0.368543, -0.0123339, 0.928679)
bones/3/rotation = Quaternion(0.0476422, 0.0388028, -0.0107706, 0.998052)
bones/4/rotation = Quaternion(0.0949298, 0.0799917, -0.017682, 0.992107)
bones/5/rotation = Quaternion(0.0824908, 0.0801758, -0.0166705, 0.993222)
bones/6/rotation = Quaternion(0.00360681, -0.0109654, -0.000360051, 0.999933)
bones/7/rotation = Quaternion(-0.0130764, 0.174079, -0.0204315, 0.984433)
bones/11/rotation = Quaternion(0.479466, 0.507265, -0.507856, 0.504854)
bones/12/rotation = Quaternion(0.588763, -0.0987989, 0.00490448, 0.80223)
bones/13/rotation = Quaternion(0.0263528, 0.0547098, 0.416376, 0.907162)
bones/14/rotation = Quaternion(-0.15619, 0.181306, -0.00995847, 0.970893)
bones/15/rotation = Quaternion(0.262634, 0.212029, 0.259398, 0.904865)
bones/16/rotation = Quaternion(-0.00209884, 0.134444, -0.0318078, 0.990408)
bones/17/rotation = Quaternion(4.73019e-08, 0.0435342, -1.1627e-08, 0.999052)
bones/19/rotation = Quaternion(0.0422014, -0.0276999, 0.0909837, 0.994572)
bones/20/rotation = Quaternion(0.150209, 0.00424024, -0.0113487, 0.98858)
bones/21/rotation = Quaternion(-2.91038e-11, 1.02459e-17, 3.52048e-07, 1)
bones/23/rotation = Quaternion(0.128766, -0.0234933, -0.0465086, 0.990305)
bones/24/rotation = Quaternion(0.200548, 0.0119778, 0.00717658, 0.979584)
bones/25/rotation = Quaternion(-1.35635e-06, -0.00292555, -0.000449612, 0.999996)
bones/27/rotation = Quaternion(0.294514, -0.0278546, -0.126193, 0.946869)
bones/28/rotation = Quaternion(0.347341, 0.0117725, 0.0392882, 0.936842)
bones/29/rotation = Quaternion(-4.07365e-10, -7.63062e-17, -1.87317e-07, 1)
bones/31/rotation = Quaternion(0.521956, -0.465029, 0.478794, 0.5311)
bones/32/rotation = Quaternion(0.538452, 0.0635086, 0.216061, 0.812006)
bones/33/rotation = Quaternion(0.0896786, 0.0257636, -0.358429, 0.928882)
bones/34/rotation = Quaternion(0.102825, -0.0921156, -0.0217543, 0.990186)
bones/35/rotation = Quaternion(0.172427, -0.072072, -0.304214, 0.934092)
bones/36/rotation = Quaternion(0.069184, -0.127673, 0.196608, 0.969669)
bones/37/rotation = Quaternion(-8.84919e-08, -0.0435343, 3.14176e-08, 0.999052)
bones/39/rotation = Quaternion(0.0362239, 0.0319641, -0.0214483, 0.998602)
bones/40/rotation = Quaternion(0.145831, -0.0050482, 0.0150609, 0.989182)
bones/41/rotation = Quaternion(-2.91038e-11, -1.02459e-17, -3.52048e-07, 1)
bones/43/rotation = Quaternion(0.106516, 0.0360081, -0.00254555, 0.993656)
bones/44/rotation = Quaternion(0.303187, -0.0112665, -0.00779354, 0.952833)
bones/45/rotation = Quaternion(-1.35271e-06, 0.00292566, 0.000449672, 0.999996)
bones/47/rotation = Quaternion(0.201827, 0.000407766, 0.064634, 0.977286)
bones/48/rotation = Quaternion(0.370225, -0.0131909, -0.0588221, 0.926984)
bones/49/rotation = Quaternion(-4.07365e-10, 7.63062e-17, 1.87317e-07, 1)
bones/51/rotation = Quaternion(0.0705224, 0.237246, 0.961763, -0.117269)
bones/52/rotation = Quaternion(-0.309478, 0.127036, -0.0174253, 0.942222)
bones/53/rotation = Quaternion(0.569859, -0.0549717, -0.0584049, 0.817819)
bones/54/rotation = Quaternion(0.192469, -0.017606, 0.09781, 0.976258)
bones/56/rotation = Quaternion(-0.132807, -0.0891344, 0.979189, 0.124923)
bones/57/rotation = Quaternion(-0.231831, 0.0598795, -0.0747984, 0.968026)
bones/58/rotation = Quaternion(0.701661, 0.129626, 0.149817, 0.684415)
bones/59/rotation = Quaternion(0.184468, 0.0348245, -0.124435, 0.974307)

[node name="ankle_low" parent="root/Skeleton3D" index="0"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="chest_low" parent="root/Skeleton3D" index="1"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="ear_joint_low" parent="root/Skeleton3D" index="2"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="ears_low" parent="root/Skeleton3D" index="3"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="feet_low" parent="root/Skeleton3D" index="4"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="finger_index_low" parent="root/Skeleton3D" index="5"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="finger_middle_low" parent="root/Skeleton3D" index="6"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="finger_pinky_low" parent="root/Skeleton3D" index="7"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="finger_thumb_low" parent="root/Skeleton3D" index="8"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="forearm_low" parent="root/Skeleton3D" index="9"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="head_main_low" parent="root/Skeleton3D" index="11"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="head_mohawk_low" parent="root/Skeleton3D" index="12"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="head_screen_low" parent="root/Skeleton3D" index="13"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="heels_low" parent="root/Skeleton3D" index="14"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="palm_low" parent="root/Skeleton3D" index="15"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="pelvis_low" parent="root/Skeleton3D" index="16"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="scarf_low" parent="root/Skeleton3D" index="17"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="screw_low" parent="root/Skeleton3D" index="18"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="shin_low" parent="root/Skeleton3D" index="19"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="shoulder_low" parent="root/Skeleton3D" index="20"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="thigh_low" parent="root/Skeleton3D" index="21"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="torso_mid_low" parent="root/Skeleton3D" index="22"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="upperarm_low" parent="root/Skeleton3D" index="23"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="wrist_low" parent="root/Skeleton3D" index="24"]
surface_material_override/0 = SubResource("ShaderMaterial_ouy15")

[node name="hitArea" parent="hitNodes" index="0"]
priority = 5

[node name="CollisionShape3D" parent="hitNodes/hitArea" index="0"]
shape = SubResource("BoxShape3D_p8lqk")

[node name="CollisionShape3D2" parent="hitNodes/hitArea" index="1"]
shape = SubResource("BoxShape3D_fsbx3")

[node name="CollisionShape3D3" parent="hitNodes/hitArea" index="2"]
shape = SubResource("BoxShape3D_tl0he")

[node name="CollisionShape3D5" parent="hitNodes/hitArea" index="3"]
shape = SubResource("BoxShape3D_tl0he")

[node name="CollisionShape3D4" parent="hitNodes/hitArea" index="4"]
shape = SubResource("BoxShape3D_p8lqk")

[node name="CollisionShape3D6" type="CollisionShape3D" parent="hitNodes/hitArea" index="5"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0186736, 0.677185, -0.0816349)
shape = SubResource("BoxShape3D_oht2c")

[node name="hitPredictionArea" type="Area3D" parent="hitNodes" index="1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0167713, 0, 0.145831)
collision_layer = 0
collision_mask = 16

[node name="CollisionShape3D" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="0"]
transform = Transform3D(0.917164, 0, -0.398509, 0, 1, 0, 0.398509, 0, 0.917164, 0.91968, 0.812524, 0.497738)
shape = SubResource("BoxShape3D_p8lqk")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="1"]
transform = Transform3D(0.999692, 0, -0.0248335, 0, 1, 0, 0.0248335, 0, 0.999692, 0.0037188, 0.812524, 0.961651)
shape = SubResource("BoxShape3D_fsbx3")

[node name="CollisionShape3D3" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="2"]
transform = Transform3D(0.651979, 0, 0.758237, 0, 1, 0, -0.758237, 0, 0.651979, -0.964785, 0.812524, 1.0705)
shape = SubResource("BoxShape3D_tl0he")

[node name="CollisionShape3D4" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="3"]
transform = Transform3D(0.65096, 0, -0.759112, 0, 1, 0, 0.759112, 0, 0.65096, 0.932687, 0.805996, 1.06904)
shape = SubResource("BoxShape3D_tl0he")

[node name="CollisionShape3D5" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="4"]
transform = Transform3D(-0.914028, 0, -0.405652, 0, 1, 0, 0.405652, 0, -0.914028, -0.936635, 0.812524, 0.524693)
shape = SubResource("BoxShape3D_p8lqk")

[node name="CollisionShape3D7" type="CollisionShape3D" parent="hitNodes/hitPredictionArea" index="5"]
transform = Transform3D(1, 0, 3.4112e-08, 0, 1, 0, -3.4112e-08, 0, 1, 0.0186738, 0.677185, -0.081635)
shape = SubResource("BoxShape3D_oht2c")

[node name="Trail" parent="hitNodes/hitDirection" index="0"]
material_override = SubResource("ShaderMaterial_o7eui")

[node name="AnimationTree" parent="animationManager" index="0"]
tree_root = SubResource("AnimationNodeStateMachine_nljpi")

[node name="stateMachine" type="Node" parent="." index="4" node_paths=PackedStringArray("initial_state")]
script = ExtResource("3_03ql3")
initial_state = NodePath("Idle")

[node name="Defend" type="Node" parent="stateMachine" index="0"]
script = ExtResource("4_4o8ek")

[node name="Idle" type="Node" parent="stateMachine" index="1"]
script = ExtResource("6_i74hs")

[node name="Attack" type="Node" parent="stateMachine" index="2"]
script = ExtResource("9_rudlm")

[node name="Charge" type="Node" parent="stateMachine" index="3"]
script = ExtResource("9_jc1lt")

[node name="navigationAgent" type="NavigationAgent3D" parent="." index="5"]
path_desired_distance = 2.0

[node name="Sprite3D" parent="hitManager" index="1"]
texture = SubResource("ViewportTexture_brdgy")

[connection signal="area_entered" from="hitNodes/hitPredictionArea" to="stateMachine/Attack" method="_on_hit_prediction_area_area_entered"]
[connection signal="reset_prediction_area" from="stateMachine/Attack" to="." method="_on_attack_reset_prediction_area"]

[editable path="root"]
